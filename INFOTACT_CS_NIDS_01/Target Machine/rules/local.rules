# $Id: local.rules,v 1.11 2004/07/23 20:15:44 bmc Exp $
# ----------------
# LOCAL RULES
# ----------------
# This file intentionally does not come with signatures.  Put your local
# additions here.

# local.rules - Custom Snort rules (lab)
# Place this file at /etc/snort/rules/local.rules
# All SIDs >= 1000000 (local rules)

########################################################################
# SSH brute-force (alert)
# Triggers after 5 or more established SSH connection attempts from same src within 60s
########################################################################
alert tcp any any -> $HOME_NET 22 (msg:"SSH Brute-Force Attempt Detected"; flow:to_server,established; detection_filter:track by_src, count 5, seconds 60; classtype:attempted-admin; priority:1; sid:1000002; rev:2;)

# Optional IPS (drop) version - ONLY enable if Snort is running inline/IPS
# drop tcp any any -> $HOME_NET 22 (msg:"SSH Brute-Force Attempt - Block"; flow:to_server,established; detection_filter:track by_src, count 5, seconds 60; classtype:attempted-admin; priority:1; sid:1000003; rev:1;)

########################################################################
# FTP brute-force (alert)
# Triggers after 10 or more established FTP connection attempts from same src within 60s
########################################################################
alert tcp any any -> $HOME_NET 21 (msg:"FTP Brute-Force Attempt Detected"; flow:to_server,established; detection_filter:track by_src, count 10, seconds 60; classtype:attempted-admin; priority:1; sid:1000200; rev:1;)

########################################################################
# Nmap scan detection (SYN / FIN / XMAS)
# Tune count/seconds for your environment to reduce false positives.
########################################################################

# Nmap SYN scan (many SYNs to many ports)
alert tcp any any -> $HOME_NET any (msg:"Nmap SYN scan detected"; flags:S; detection_filter:track by_src, count 20, seconds 60; classtype:attempted-recon; priority:2; sid:1000100; rev:1;)

# Nmap FIN scan
alert tcp any any -> $HOME_NET any (msg:"Nmap FIN scan detected"; flags:F; detection_filter:track by_src, count 20, seconds 60; classtype:attempted-recon; priority:2; sid:1000101; rev:1;)

# Nmap XMAS scan (FIN,PSH,URG)
alert tcp any any -> $HOME_NET any (msg:"Nmap XMAS scan detected"; flags:FPU; detection_filter:track by_src, count 20, seconds 60; classtype:attempted-recon; priority:2; sid:1000102; rev:1;)

########################################################################
# Simple HTTP C2 beacon signature (example)
# Matches repeated GETs for /update.php to web ports (80,8080). Adjust URI & ports for your lab.
# Uses uricontent so rule header uses TCP (required by Snort).
########################################################################
alert tcp any any -> $HOME_NET 80,8080 (msg:"Possible C2 Beacon - suspicious URI /update.php"; flow:to_server,established; uricontent:"/update.php"; nocase; detection_filter:track by_src, count 5, seconds 300; classtype:trojan-activity; priority:2; sid:1000300; rev:2;)

# If you want to monitor any TCP destination (less strict), use this variant instead:
# alert tcp any any -> $HOME_NET any (msg:"Possible C2 Beacon - suspicious URI /update.php"; flow:to_server,established; uricontent:"/update.php"; nocase; detection_filter:track by_src, count 5, seconds 300; classtype:trojan-activity; priority:2; sid:1000301; rev:1;)

########################################################################
# End of local.rules
########################################################################

